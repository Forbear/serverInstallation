pipeline {
    agent any
    environment {
        isDockerUp = """${sh(
            returnStdout: true,
            script: 'sudo systemctl is-active docker | grep -q "inactive" && echo -n "false" || echo -n "true"'
        )}"""
    }
    parameters {
        choice(
            name: 'ACTIVITY',
            choices: ["None", "Build", "Destroy"],
            description: 'Activity to perform.')
    }
    stages {
        stage('Docker build.') {
            when {
                expression {
                    env.isDockerUp == 'true' && params.ACTIVITY == 'Build'
                }
            }
            steps {
                sh './serverInstall.sh'
            }
        }
        stage('Docker destroy.') {
            when {
                expression {
                    env.isDockerUp == 'true' && params.ACTIVITY == 'Destroy'
                }
            }
            steps {
                echo "End."
            }
        }
    }
}
